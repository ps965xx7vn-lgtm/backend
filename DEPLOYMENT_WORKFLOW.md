# ๐ Workflow ะดะตะฟะปะพั Pyland

## ๐ ะะฑะทะพั ะฟัะพัะตััะฐ

```
ะะพะบะฐะปัะฝะพ                GitHub               ะกะตัะฒะตั
โโโโโโโโ               โโโโโโโโ             โโโโโโโโ

1. ะะทะผะตะฝะตะฝะธั    โ    2. Push      โ    3. Git Clone    โ    4. ะฃััะฐะฝะพะฒะบะฐ
   ะฒ ะบะพะดะต              ะฒ main/dev           ะฝะฐ ัะตัะฒะตั          ะธ ะทะฐะฟััะบ

     โ                    โ                    โ                  โ

  Commit            Repository          /opt/pyland         SSL + Nginx
   + Push             Updated              backend            Running
```

## ๐ ะะพะปะฝัะน ะฟัะพัะตัั ะดะตะฟะปะพั

### ะะฐัะธะฐะฝั 1: Production (ะฒะตัะบะฐ main)

```bash
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะะะะะะฌะะ (ะฒะฐั ะบะพะผะฟัััะตั)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# 1. ะะพะดะณะพัะพะฒะบะฐ ะธ push ะฒ main
cd /path/to/backend
./nginx/scripts/prepare_deploy.sh
# ะัะฑะตัะธัะต: 1) main (production)
# ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะดะตะปะฐะตั commit ะธ push

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะะ ะกะะะะะะ (78.40.219.145)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# 2. ะะพะดะบะปััะตะฝะธะต ะบ ัะตัะฒะตัั
ssh root@78.40.219.145

# 3. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธะท main ะธ ัััะฐะฝะพะฒะบะฐ
mkdir -p /opt/pyland && cd /opt/pyland
git clone -b main https://github.com/ps965xx7vn-lgtm/backend.git
cd backend/nginx/scripts
sudo ./install.sh

# 4. ะะฐัััะพะนะบะฐ ะฟะพัะปะต ัััะฐะฝะพะฒะบะธ
nano /opt/pyland/backend/.env
sudo -u pyland /opt/pyland/.venv/bin/python /opt/pyland/backend/src/manage.py createsuperuser
sudo certbot --nginx -d pylandschool.com -d www.pylandschool.com
sudo systemctl restart nginx

# โ ะะพัะพะฒะพ! https://pylandschool.com
```

### ะะฐัะธะฐะฝั 2: Testing/Staging (ะฒะตัะบะฐ dev)

```bash
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะะะะะะฌะะ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# 1. ะะพะดะณะพัะพะฒะบะฐ ะธ push ะฒ dev
cd /path/to/backend
./nginx/scripts/prepare_deploy.sh
# ะัะฑะตัะธัะต: 2) dev (development/testing)
# ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะดะตะปะฐะตั commit ะธ push ะฒ dev

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะะ ะกะะะะะะ (ัะตััะพะฒัะน/staging ัะตัะฒะตั)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# 2. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธะท dev
ssh root@your-staging-server
mkdir -p /opt/pyland && cd /opt/pyland
git clone -b dev https://github.com/ps965xx7vn-lgtm/backend.git
cd backend/nginx/scripts

# 3. ะฃััะฐะฝะพะฒะบะฐ ั ัะบะฐะทะฐะฝะธะตะผ ะฒะตัะบะธ dev
GIT_BRANCH=dev sudo ./install.sh

# 4. ะะฐัััะพะนะบะฐ...
# ... ะฐะฝะฐะปะพะณะธัะฝะพ production
```

## ๐ ะะตะฟะปะพะน ะพะฑะฝะพะฒะปะตะฝะธะน

### ะะพัะปะต ะธะทะผะตะฝะตะฝะธะน ะฒ ะบะพะดะต:

```bash
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะะะะะะฌะะ: ะะพะดะณะพัะพะฒะบะฐ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
./nginx/scripts/prepare_deploy.sh
# ะัะฑะตัะธัะต ะฝัะถะฝัั ะฒะตัะบั, ัะบัะธะฟั ัะดะตะปะฐะตั commit + push

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะะ ะกะะะะะะ: ะัะธะผะตะฝะตะฝะธะต
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ssh root@78.40.219.145
cd /opt/pyland/backend/nginx/scripts
sudo ./deploy.sh

# ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ:
# - ะกะดะตะปะฐะตั git pull origin main (ะธะปะธ ัะตะบััะฐั ะฒะตัะบะฐ)
# - ะะฑะฝะพะฒะธั ะทะฐะฒะธัะธะผะพััะธ ัะตัะตะท poetry
# - ะัะธะผะตะฝะธั ะผะธะณัะฐัะธะธ ะะ
# - ะกะพะฑะตัะตั ััะฐัะธะบั
# - ะะตัะตะทะฐะฟัััะธั ะฒัะต ัะตัะฒะธัั
```

## ๐ ะงัะพ ะฟัะพะธััะพะดะธั ะฝะฐ ะบะฐะถะดะพะผ ััะฐะฟะต

### ะกะบัะธะฟั `prepare_deploy.sh` (ะปะพะบะฐะปัะฝะพ):

```
1. ะัะพะฒะตัะบะฐ git ัะตะฟะพะทะธัะพัะธั โ
2. ะัะพะฒะตัะบะฐ ะฝะตัะพััะฐะฝะตะฝะฝัั ะธะทะผะตะฝะตะฝะธะน โ
3. ะัะพะฒะตัะบะฐ nginx ะบะพะฝัะธะณััะฐัะธะธ โ
4. ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะฝะฐ ัะบัะธะฟัั โ
5. ะัะฑะพั ะฒะตัะบะธ (main/dev/ัะตะบััะฐั) โ
6. ะะตัะตะบะปััะตะฝะธะต ะฝะฐ ะฒะตัะบั (ะตัะปะธ ะฝัะถะฝะพ) โ
7. Git fetch ะธ ะฟัะพะฒะตัะบะฐ ะฐะบััะฐะปัะฝะพััะธ โ
8. ะกะพะทะดะฐะฝะธะต ะบะพะผะผะธัะฐ (ะตัะปะธ ะตััั ะธะทะผะตะฝะตะฝะธั) โ
9. Push ะฒ origin โ
10. ะัะฒะพะด ะธะฝััััะบัะธะน ะดะปั ะดะตะฟะปะพั โ
```

### ะกะบัะธะฟั `install.sh` (ะฝะฐ ัะตัะฒะตัะต):

```
1. ะะฑะฝะพะฒะปะตะฝะธะต ัะธััะตะผั โ
2. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน (Python, PostgreSQL, Redis, Nginx) โ
3. ะกะพะทะดะฐะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั pyland โ
4. ะะฐัััะพะนะบะฐ PostgreSQL โ
5. ะะฐัััะพะนะบะฐ Redis โ
6. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธะท GitHub (ะฒะตัะบะฐ main ะธะปะธ GIT_BRANCH) โ
7. ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั โ
8. ะฃััะฐะฝะพะฒะบะฐ Python ะฟะฐะบะตัะพะฒ ัะตัะตะท Poetry โ
9. ะกะพะทะดะฐะฝะธะต .env ัะฐะนะปะฐ โ
10. ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน โ
11. ะกะพะทะดะฐะฝะธะต ัะพะปะตะน ะฟะพะปัะทะพะฒะฐัะตะปะตะน โ
12. ะกะฑะพั ััะฐัะธะบะธ โ
13. ะะพะผะฟะธะปััะธั ะฟะตัะตะฒะพะดะพะฒ โ
14. ะฃััะฐะฝะพะฒะบะฐ systemd ัะตัะฒะธัะพะฒ โ
15. ะะฐัััะพะนะบะฐ Nginx โ
16. ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ โ
```

### ะกะบัะธะฟั `deploy.sh` (ะพะฑะฝะพะฒะปะตะฝะธั):

```
1. Git pull ะฟะพัะปะตะดะฝะธั ะธะทะผะตะฝะตะฝะธะน โ
2. ะะฑะฝะพะฒะปะตะฝะธะต Python ะทะฐะฒะธัะธะผะพััะตะน โ
3. ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน ะะ โ
4. ะกะฑะพั ััะฐัะธะบะธ โ
5. ะะพะผะฟะธะปััะธั ะฟะตัะตะฒะพะดะพะฒ โ
6. ะะตัะตะทะฐะฟััะบ Gunicorn โ
7. ะะตัะตะทะฐะฟััะบ Celery Worker โ
8. ะะตัะตะทะฐะฟััะบ Celery Beat โ
9. ะะตัะตะทะฐะณััะทะบะฐ Nginx โ
10. ะัะพะฒะตัะบะฐ ััะฐัััะฐ ัะตัะฒะธัะพะฒ โ
```

## ๐ณ ะะฐะฑะพัะฐ ั ะฒะตัะบะฐะผะธ

### ะกััะฐัะตะณะธั ะฒะตัะพะบ:

```
main (production)
  โ
  โโโ ะกัะฐะฑะธะปัะฝัะน ะบะพะด
  โโโ ะะตะฟะปะพะธััั ะฝะฐ production ัะตัะฒะตั
  โโโ ะัะตะณะดะฐ ะณะพัะพะฒ ะบ ัะตะปะธะทั

dev (development/testing)
  โ
  โโโ ะะพะฒัะต ัะธัะธ
  โโโ ะขะตััะธัะพะฒะฐะฝะธะต
  โโโ ะะตะฟะปะพะธััั ะฝะฐ staging ัะตัะฒะตั
  โโโ ะะตัะถะธััั ะฒ main ะฟะพัะปะต ะฟัะพะฒะตัะบะธ
```

### ะะตัะตะบะปััะตะฝะธะต ะผะตะถะดั ะฒะตัะบะฐะผะธ:

```bash
# ะะพะบะฐะปัะฝะพ: ัะฐะฑะพัะฐ ั dev
git checkout dev
git pull origin dev
# ... ะดะตะปะฐะตัะต ะธะทะผะตะฝะตะฝะธั ...
./nginx/scripts/prepare_deploy.sh  # ะัะฑะตัะธัะต dev

# ะะพัะปะต ัะตััะธัะพะฒะฐะฝะธั: merge ะฒ main
git checkout main
git merge dev
git push origin main
./nginx/scripts/prepare_deploy.sh  # ะัะฑะตัะธัะต main

# ะะฐ production ัะตัะฒะตัะต
ssh root@78.40.219.145
cd /opt/pyland/backend
sudo -u pyland git fetch origin
sudo -u pyland git checkout main
sudo -u pyland git pull origin main
cd nginx/scripts
sudo ./deploy.sh
```

## ๐ ะัะพะฒะตัะบะฐ ัะตะบััะตะณะพ ัะพััะพัะฝะธั

```bash
# ะะฐ ัะตัะฒะตัะต: ะฟัะพะฒะตัะธัั ะบะฐะบะฐั ะฒะตัะบะฐ ะธัะฟะพะปัะทัะตััั
cd /opt/pyland/backend
git branch  # ะะพะบะฐะถะตั ัะตะบัััั ะฒะตัะบั
git log -1  # ะะพัะปะตะดะฝะธะน ะบะพะผะผะธั

# ะกัะฐััั ัะตัะฒะธัะพะฒ
cd nginx/scripts
sudo ./manage_services.sh status

# ะะพะณะธ
sudo journalctl -u pyland-gunicorn -n 50
sudo tail -f /opt/pyland/backend/logs/gunicorn-error.log
```

## โ๏ธ ะะฐะถะฝัะต ะผะพะผะตะฝัั

1. **ะัะตะณะดะฐ commit + push ะะะะะ ะดะตะฟะปะพะตะผ**
   - ะกะบัะธะฟั `install.sh` ะบะปะพะฝะธััะตั ะบะพะด ะธะท GitHub
   - ะะพะบะฐะปัะฝัะต ะฝะตะทะฐะฟััะตะฝะฝัะต ะธะทะผะตะฝะตะฝะธั ะะ ะฟะพะฟะฐะดัั ะฝะฐ ัะตัะฒะตั

2. **ะฃะบะฐะทัะฒะฐะนัะต ะฟัะฐะฒะธะปัะฝัั ะฒะตัะบั**
   - Production: `git clone -b main`
   - Testing: `git clone -b dev` ะธ `GIT_BRANCH=dev sudo ./install.sh`

3. **DNS ะดะพะปะถะตะฝ ะฑััั ะฝะฐัััะพะตะฝ**
   - ะะฝะฐัะต SSL ัะตััะธัะธะบะฐั ะฝะต ะฟะพะปััะธััั

4. **HTTPS ะพะฑัะทะฐัะตะปะตะฝ**
   - HTTP ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตะดะธัะตะบัะธััั ะฝะฐ HTTPS
   - ะะพ ะฟะพะปััะตะฝะธั SSL ัะฐะนั ะฑัะดะตั ะฝะตะดะพัััะฟะตะฝ

## ๐ ะัะบะฐั ะบ ะฟัะตะดัะดััะตะน ะฒะตััะธะธ

```bash
# ะะฐ ัะตัะฒะตัะต
cd /opt/pyland/backend

# ะะพัะผะพััะตัั ะธััะพัะธั ะบะพะผะผะธัะพะฒ
git log --oneline -10

# ะัะบะฐัะธัััั ะฝะฐ ะบะพะฝะบัะตัะฝัะน ะบะพะผะผะธั
sudo -u pyland git checkout <commit-hash>

# ะะปะธ ะฝะฐ ะฟัะตะดัะดััะธะน ัะตะณ/ัะตะปะธะท
sudo -u pyland git checkout v1.0.0

# ะัะธะผะตะฝะธัั ะธะทะผะตะฝะตะฝะธั
cd nginx/scripts
sudo ./deploy.sh
```

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตััััั

- [DEPLOYMENT_QUICK.md](DEPLOYMENT_QUICK.md) - ะััััะฐั ัะฟะฐัะณะฐะปะบะฐ
- [INSTALL_GUIDE.md](INSTALL_GUIDE.md) - ะะพัะฐะณะพะฒะฐั ะธะฝััััะบัะธั
- [nginx/README.md](nginx/README.md) - ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
- [nginx/DNS_SETUP.md](nginx/DNS_SETUP.md) - ะะฐัััะพะนะบะฐ DNS

---

**ะฃัะฟะตัะฝะพะณะพ ะดะตะฟะปะพั! ๐**
