{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}PyLand - {% trans "Регистрация" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/core/phone-input.css' %}">
{% endblock %}

{% block content %}
<!-- Modern Auth Section -->
<section class="modern-auth-section">
    <div class="auth-container">
        <!-- Left Side - Form -->
        <div class="auth-form-side">
            <div class="auth-form-container">
                <!-- Logo & Welcome -->
                <div class="auth-header">
                    <div class="auth-logo">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="auth-logo-text">PyLand</span>
                    </div>
                    <h1 class="auth-title">{% trans "Создайте аккаунт" %}</h1>
                    <p class="auth-subtitle">{% trans "Начните своё путешествие в мир программирования уже сегодня" %}</p>
                </div>

                <!-- Django Messages -->
                {% if messages %}
                    <div class="messages-container">
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- Form -->
                <form method="post" class="modern-auth-form" novalidate>
                    {% csrf_token %}
                    {% if form.non_field_errors %}
                        <div class="form-errors">
                            {% for error in form.non_field_errors %}
                                <div class="form-error visible">{{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <!-- First Name -->
                    <div class="form-group">
                        <label for="{{ form.first_name.id_for_label }}" class="form-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            {% trans "Имя" %}
                        </label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            <div class="form-error visible">
                                {% for error in form.first_name.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Phone Number -->
                    <div class="form-group">
                        <label for="{{ form.phone_number.id_for_label }}" class="form-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            {% trans "Телефон" %}
                        </label>
                        <div class="phone-input-wrapper phone-input-group">
                            <div class="country-select-wrapper">
                                <select class="country-select" id="signup-country-code" aria-label="{% trans 'Выберите страну' %}">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                                <svg class="country-select-arrow" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </div>
                            {{ form.phone_number }}
                        </div>
                        {% if form.phone_number.errors %}
                            <div class="form-error visible">
                                {% for error in form.phone_number.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Email Field -->
                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2"/>
                                <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            {% trans "Email адрес" %}
                        </label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <div class="form-error visible">
                                {% for error in form.email.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Password Fields -->
                    <!-- Password Field -->
                    <div class="form-group">
                        <label for="{{ form.password.id_for_label }}" class="form-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            {% trans "Пароль" %}
                        </label>
                        <div class="password-field">
                            {{ form.password }}
                            <button type="button" class="password-toggle">
                                <svg class="eye-open" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <svg class="eye-closed" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2"/>
                                    <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                        </div>
                        {% if form.password.errors %}
                            <div class="form-error visible">
                                {% for error in form.password.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}

                        <!-- Password Strength Indicator -->
                        <div class="password-strength-container">
                            <div class="password-strength">
                                <div class="strength-bar" id="strength-bar"></div>
                            </div>
                            <div class="strength-text" id="strength-text">{% trans "Сила пароля" %}</div>
                        </div>
                    </div>

                    <!-- Confirm Password Field -->
                    <div class="form-group">
                        <label for="{{ form.confirm_password.id_for_label }}" class="form-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            {% trans "Подтвердите пароль" %}
                        </label>
                        <div class="password-field">
                            {{ form.confirm_password }}
                            <button type="button" class="password-toggle">
                                <svg class="eye-open" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <svg class="eye-closed" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2"/>
                                    <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                        </div>
                        {% if form.confirm_password.errors %}
                            <div class="form-error visible">
                                {% for error in form.confirm_password.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Terms & Conditions -->
                    <div class="form-group">
                        <div class="auth-options">
                            <label class="checkbox-wrapper">
                                {{ form.agree_to_terms }}
                                <span class="checkmark"></span>
                                <span class="checkbox-text">
                                    {% trans "Я согласен с" %}
                                    <a href="{% url 'core:terms_of_service' %}" class="terms-link" target="_blank">{% trans "условиями использования" %}</a>
                                    {% trans "и" %}
                                    <a href="{% url 'core:privacy_policy' %}" class="terms-link" target="_blank">{% trans "политикой конфиденциальности" %}</a>
                                </span>
                            </label>
                        </div>
                        {% if form.agree_to_terms.errors %}
                            <div class="form-error visible">
                                {% for error in form.agree_to_terms.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Email Updates -->
                    <div class="form-group">
                        <div class="auth-options">
                            <label class="checkbox-wrapper">
                                {{ form.show_notifications }}
                                <span class="checkmark"></span>
                                <span class="checkbox-text">{% trans "Отправить email с подтверждением регистрации" %}</span>
                            </label>
                        </div>
                        {% if form.show_notifications.help_text %}
                            <small class="form-text text-muted">{{ form.show_notifications.help_text }}</small>
                        {% endif %}
                        {% if form.show_notifications.errors %}
                            <div class="form-error visible">
                                {% for error in form.show_notifications.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="auth-options">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" name="email_updates">
                            <span class="checkmark"></span>
                            <span class="checkbox-text">{% trans "Получать новости о новых курсах и акциях" %}</span>
                        </label>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="auth-submit-btn">
                        <span class="btn-text">{% trans "Создать аккаунт" %}</span>
                        <svg class="btn-arrow" width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>

                    <!-- Social Login -->
                    <div class="social-divider">
                        <span>{% trans "или зарегистрируйтесь через" %}</span>
                    </div>

                    <div class="social-buttons">
                        <button type="button" class="social-btn google-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Google
                        </button>
                        <button type="button" class="social-btn github-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                            </svg>
                            GitHub
                        </button>
                    </div>
                </form>

                <!-- Login Link -->
                <div class="auth-footer">
                    <p>{% trans "Уже есть аккаунт?" %}
                        <a href="{% url 'authentication:signin' %}" class="auth-link">
                            {% trans "Войти" %}
                        </a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Right Side - Visual -->
        <div class="auth-visual-side">
            <div class="auth-visual-content">
                <div class="visual-elements">
                    <!-- Floating Icons -->
                    <div class="floating-icon icon-1">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="floating-icon icon-2">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="floating-icon icon-3">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                </div>

                <div class="visual-text">
                    <h2>{% trans "Начните своё IT-путешествие" %}</h2>
                    <p>{% trans "Получите доступ к премиальным курсам, интерактивным заданиям и персональной поддержке от экспертов индустрии." %}</p>

                    <div class="features-list">
                        <div class="feature-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>{% trans "Сертификаты о прохождении" %}</span>
                        </div>
                        <div class="feature-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>{% trans "Поддержка менторов 24/7" %}</span>
                        </div>
                        <div class="feature-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>{% trans "Практические проекты" %}</span>
                        </div>
                        <div class="feature-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>{% trans "Помощь в трудоустройстве" %}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const toggle = input.parentElement.querySelector('.password-toggle');
    const eyeOpen = toggle.querySelector('.eye-open');
    const eyeClosed = toggle.querySelector('.eye-closed');

    if (input.type === 'password') {
        input.type = 'text';
        eyeOpen.style.display = 'none';
        eyeClosed.style.display = 'block';
    } else {
        input.type = 'password';
        eyeOpen.style.display = 'block';
        eyeClosed.style.display = 'none';
    }
}

// Password strength checker
document.addEventListener('DOMContentLoaded', function() {
    const passwordField = document.getElementById('{{ form.password.id_for_label }}');
    if (passwordField) {
        passwordField.addEventListener('input', function(e) {
            const password = e.target.value;
            const strengthBar = document.getElementById('strength-bar');
            const strengthText = document.getElementById('strength-text');

            let strength = 0;
            let text = '{% trans "Слабый" %}';

            // Check password strength
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            // Set strength level
            if (strength === 0) {
                strengthBar.style.width = '0%';
                strengthBar.className = 'strength-bar';
                text = '{% trans "Слабый" %}';
            } else if (strength <= 2) {
                strengthBar.style.width = '25%';
                strengthBar.className = 'strength-bar weak';
                text = '{% trans "Слабый" %}';
            } else if (strength <= 3) {
                strengthBar.style.width = '50%';
                strengthBar.className = 'strength-bar medium';
                text = '{% trans "Средний" %}';
            } else if (strength <= 4) {
                strengthBar.style.width = '75%';
                strengthBar.className = 'strength-bar good';
                text = '{% trans "Хороший" %}';
            } else {
                strengthBar.style.width = '100%';
                strengthBar.className = 'strength-bar strong';
                text = '{% trans "Отличный" %}';
            }

            strengthText.textContent = text;
        });
    }
});
</script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/core/phone-input.js' %}"></script>
<script src="{% static 'js/students/auth.js' %}"></script>
<script>
// Initialize password strength checker with translated strings
document.addEventListener('DOMContentLoaded', function() {
    initPasswordStrength(
        '{{ form.password.id_for_label }}',
        '{% trans "Слабый" %}',
        '{% trans "Средний" %}',
        '{% trans "Хороший" %}',
        '{% trans "Отличный" %}'
    );
});
</script>
{% endblock %}
