{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load dashboard_filters %}

{% block title %}{% trans "–î–∞—à–±–æ—Ä–¥" %} - {{ profile.user.email }} - PyLand{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/students/dashboard.css' %}?v=20251212-fixed">
{% endblock %}

{% block header %}
{% include 'shared/_header.html' with show_dashboard_button=True %}
{% endblock %}

{% block content %}
<!-- Sidebar overlay -->
<div class="sidebar-overlay"></div>

<div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
        <!-- –ü—É—Å—Ç–æ–π –±–ª–æ–∫ –¥–ª—è –æ—Ç—Å—Ç—É–ø–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
        <div class="sidebar-spacer"></div>

        <!-- User Info -->
        <div class="dashboard-user-info">
            <div class="dashboard-avatar">
                {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="{{ profile.user.email }}">
                {% else %}
                    {{ profile.user.email|first|upper }}
                {% endif %}
            </div>
            <div class="dashboard-user-details">
                <h3>
                    {% if profile.user.first_name %}
                        {{ profile.user.first_name }} {{ profile.user.last_name }}
                    {% else %}
                        {{ profile.user.email|truncatechars:20 }}
                    {% endif %}
                </h3>
                <p class="dashboard-user-role">
                    {{ profile.role.name|default:"student"|translate_role }}
                </p>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="dashboard-nav">
            <ul class="dashboard-nav-list">
                <li class="dashboard-nav-item">
                    <a href="{% url 'students:dashboard' profile.id %}" class="dashboard-nav-link active">
                        <svg class="dashboard-nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        {% trans "–î–∞—à–±–æ—Ä–¥" %}
                    </a>
                </li>
                <li class="dashboard-nav-item">
                    <a href="{% url 'students:courses' request.user.student.id %}" class="dashboard-nav-link">
                        <svg class="dashboard-nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        {% trans "–ú–æ–∏ –∫—É—Ä—Å—ã" %}
                    </a>
                </li>
                <li class="dashboard-nav-item">
                    <a href="{% url 'certificates:list' %}" class="dashboard-nav-link">
                        <svg class="dashboard-nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                        </svg>
                        {% trans "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã" %}
                    </a>
                </li>
                <li class="dashboard-nav-item">
                    <a href="{% url 'students:settings' request.user.student.id %}" class="dashboard-nav-link">
                        <svg class="dashboard-nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        {% trans "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" %}
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
        <!-- Header -->
        <header class="dashboard-header">
            <div>
                <h1 class="dashboard-title">
                    {% if profile.user.first_name %}
                        {% trans "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å" %}, {{ profile.user.first_name }}!
                    {% else %}
                        {% trans "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –¥–∞—à–±–æ—Ä–¥!" %}
                    {% endif %}
                </h1>
                <div class="dashboard-breadcrumb">
                    <span>{% trans "–ì–ª–∞–≤–Ω–∞—è" %}</span>
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="m9 18 6-6-6-6"/>
                    </svg>
                    <span>{% trans "–î–∞—à–±–æ—Ä–¥" %}</span>
                </div>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                </div>
                <h3 class="stat-value">{{ overall_stats.total_courses }}</h3>
                <p class="stat-label">{% trans "–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤" %}</p>
            </div>

            <div class="stat-card success">
                <div class="stat-header">
                    <div class="stat-icon success">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                </div>
                <h3 class="stat-value">{{ overall_stats.completed_steps }}</h3>
                <p class="stat-label">{% trans "–í—ã–ø–æ–ª–Ω–µ–Ω–æ —à–∞–≥–æ–≤" %}</p>
            </div>

            <div class="stat-card warning">
                <div class="stat-header">
                    <div class="stat-icon warning">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                </div>
                <h3 class="stat-value">{{ overall_stats.completion_percentage }}%</h3>
                <p class="stat-label">{% trans "–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å" %}</p>
            </div>

            <div class="stat-card danger">
                <div class="stat-header">
                    <div class="stat-icon danger">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                </div>
                <h3 class="stat-value">{{ recent_progress|length }}</h3>
                <p class="stat-label">{% trans "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é" %}</p>
            </div>
        </div>

        <!-- Charts Container -->
        <div class="charts-container">
            <!-- Activity Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">{% trans "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é" %}</h3>
                </div>
                <div class="chart-content" id="activity-chart"></div>
            </div>

            <!-- Progress Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">{% trans "–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å–∞–º" %}</h3>
                </div>
                <div class="chart-content" id="progress-chart"></div>
            </div>
        </div>

        <!-- Course Progress -->
        {% if all_course_stats %}
        <div class="progress-container">
            <div class="progress-header">
                <h3 class="progress-title">{% trans "–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å–∞–º" %}</h3>
            </div>
            {% for course_stat in all_course_stats %}
            <div class="progress-item">
                <div class="progress-info">
                    <span class="progress-name">{{ course_stat.course.name }}</span>
                    <span class="progress-percentage">{{ course_stat.completion_percentage }}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill {% if course_stat.completion_percentage == 100 %}success{% elif course_stat.completion_percentage >= 75 %}warning{% endif %}"
                         style="width: {{ course_stat.completion_percentage }}%"></div>
                </div>
                <div class="progress-stats">
                    {{ course_stat.completed_lessons }}/{{ course_stat.total_lessons }} {% trans "—É—Ä–æ–∫–æ–≤" %} ‚Ä¢
                    {{ course_stat.completed_steps }}/{{ course_stat.total_steps }} {% trans "—à–∞–≥–æ–≤" %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Recent Courses Grid -->
        {% if course_stats %}
        <div class="courses-grid">
            {% for course_stat in course_stats|slice:":4" %}
            <div class="course-card">
                {% if course_stat.course.image %}
                <div class="course-image">
                    <img src="{{ course_stat.course.image.url }}" alt="{{ course_stat.course.name }}">
                    <div class="course-badge">
                        {% if course_stat.is_completed %}
                            {% trans "–ó–∞–≤–µ—Ä—à–µ–Ω" %}
                        {% elif course_stat.completion_percentage >= 50 %}
                            {% trans "–í –ø—Ä–æ—Ü–µ—Å—Å–µ" %}
                        {% else %}
                            {% trans "–ù–∞—á–∞—Ç" %}
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                <div class="course-content">
                    <h4 class="course-title">{{ course_stat.course.name }}</h4>
                    <p class="course-description">{{ course_stat.course.short_description|default:course_stat.course.description|truncatechars:100 }}</p>

                    <div class="course-progress">
                        <div class="progress-info">
                            <span class="progress-name">{% trans "–ü—Ä–æ–≥—Ä–µ—Å—Å" %}</span>
                            <span class="progress-percentage">{{ course_stat.completion_percentage }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill {% if course_stat.completion_percentage == 100 %}success{% elif course_stat.completion_percentage >= 75 %}warning{% endif %}"
                                 style="width: {{ course_stat.completion_percentage }}%"></div>
                        </div>
                    </div>

                    <div class="course-stats">
                        <span>{{ course_stat.completed_lessons }}/{{ course_stat.total_lessons }} {% trans "—É—Ä–æ–∫–æ–≤" %}</span>
                        <span>{{ course_stat.completed_steps }}/{{ course_stat.total_steps }} {% trans "—à–∞–≥–æ–≤" %}</span>
                    </div>

                    <div class="course-actions">
                        <a href="{% url 'students:course_detail' request.user.student.id course_stat.course.slug %}" class="btn btn-primary btn-sm">
                            {% if course_stat.completion_percentage == 0 %}
                                {% trans "–ù–∞—á–∞—Ç—å" %}
                            {% else %}
                                {% trans "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" %}
                            {% endif %}
                        </a>
                        <a href="{% url 'courses:course_detail' course_stat.course.slug %}" class="btn btn-outline-secondary btn-sm">
                            {% trans "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" %}
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Bookmarked Articles Section -->
        {% if bookmarked_articles %}
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="section-title">
                    <i class="fas fa-bookmark" style="color: #f59e0b;"></i>
                    {% trans "–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏" %}
                    <span class="badge badge-primary">{{ bookmarked_articles.count }}</span>
                </h2>
            </div>
            <div class="bookmarked-articles-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-top: 1rem;">
                {% for bookmark in bookmarked_articles %}
                <div class="bookmarked-article-card" style="background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 12px; padding: 1rem; transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'" onclick="window.location.href='{{ bookmark.article.get_absolute_url }}'">
                    <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-color);">
                        {{ bookmark.article.title }}
                    </h3>
                    <p style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.75rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                        {{ bookmark.article.description|truncatewords:15 }}
                    </p>
                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; color: var(--text-muted);">
                        <span>
                            <i class="far fa-user"></i> {{ bookmark.article.author.username }}
                        </span>
                        <span>
                            <i class="far fa-clock"></i> {{ bookmark.created_at|timesince }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- My Submissions Section -->
        <div class="progress-container">
            <div class="progress-header">
                <h3 class="progress-title">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    {% trans "–ú–æ–∏ —Ä–∞–±–æ—Ç—ã" %}
                </h3>
                <span class="badge badge-primary">{{ submissions_count.total }}</span>
            </div>

            <!-- Submissions Stats -->
            <div class="stats-grid">
                <div class="stat-card warning">
                    <h3 class="stat-value">{{ submissions_count.pending }}</h3>
                    <p class="stat-label">‚è≥ {% trans "–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏" %}</p>
                </div>

                <div class="stat-card danger">
                    <h3 class="stat-value">{{ submissions_count.changes_requested }}</h3>
                    <p class="stat-label">‚úèÔ∏è {% trans "–¢—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏" %}</p>
                </div>

                <div class="stat-card success">
                    <h3 class="stat-value">{{ submissions_count.approved }}</h3>
                    <p class="stat-label">‚úÖ {% trans "–û–¥–æ–±—Ä–µ–Ω–æ" %}</p>
                </div>
            </div>

            <!-- Tabs for filtering submissions -->
            <div class="submissions-tabs">
                <button class="tab-button active" data-tab="changes-requested">
                    ‚úèÔ∏è {% trans "–¢—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏" %} ({{ submissions_count.changes_requested }})
                </button>
                <button class="tab-button" data-tab="pending">
                    ‚è≥ {% trans "–û–∂–∏–¥–∞—é—Ç" %} ({{ submissions_count.pending }})
                </button>
                <button class="tab-button" data-tab="approved">
                    ‚úÖ {% trans "–û–¥–æ–±—Ä–µ–Ω–æ" %} ({{ submissions_count.approved }})
                </button>
            </div>

            <!-- Changes Requested Tab -->
            <div class="tab-content" id="changes-requested-tab">
                {% if submissions_by_status.changes_requested %}
                    {% for submission in submissions_by_status.changes_requested|slice:":5" %}
                    <div class="submission-item danger">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <div>
                                <h4 style="margin: 0 0 0.25rem 0; font-size: 1.1rem;">
                                    {{ submission.get_status_icon }} {{ submission.lesson.name }}
                                </h4>
                                <p style="margin: 0; color: #6b7280; font-size: 0.875rem;">
                                    {% trans "–ö—É—Ä—Å:" %} {{ submission.lesson.course.name }}
                                </p>
                            </div>
                            <span class="badge" style="background: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem;">
                                {{ submission.get_status_display }}
                            </span>
                        </div>

                        {% if submission.mentor_comment %}
                        <div style="background: white; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.75rem;">
                            <strong style="color: #ef4444;">{% trans "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–µ–Ω—Ç–æ—Ä–∞:" %}</strong>
                            <p style="margin: 0.5rem 0 0 0; color: #374151;">{{ submission.mentor_comment }}</p>
                            {% if submission.mentor %}
                            <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.875rem;">
                                ‚Äî {{ submission.mentor.user.get_full_name|default:submission.mentor.user.email }}
                            </p>
                            {% endif %}
                        </div>
                        {% endif %}

                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem; color: #6b7280;">
                            <span>{% trans "–ü–æ–ø—ã—Ç–∫–∞:" %} {{ submission.revision_count|add:1 }}</span>
                            <a href="{% url 'students:lesson_detail' request.user.student.id submission.lesson.course.slug submission.lesson.slug %}"
                               class="btn btn-danger btn-sm">
                                ‚úèÔ∏è {% trans "–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É" %}
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center; color: #6b7280; padding: 2rem;">
                        {% trans "–ù–µ—Ç —Ä–∞–±–æ—Ç, —Ç—Ä–µ–±—É—é—â–∏—Ö –¥–æ—Ä–∞–±–æ—Ç–∫–∏" %} ‚ú®
                    </p>
                {% endif %}
            </div>

            <!-- Pending Tab -->
            <div class="tab-content" id="pending-tab" style="display: none;">
                {% if submissions_by_status.pending %}
                    {% for submission in submissions_by_status.pending|slice:":5" %}
                    <div class="submission-item warning">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h4 style="margin: 0 0 0.25rem 0;">
                                    {{ submission.get_status_icon }} {{ submission.lesson.name }}
                                </h4>
                                <p style="margin: 0; color: #6b7280; font-size: 0.875rem;">
                                    {{ submission.lesson.course.name }}
                                </p>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: #6b7280;">
                                    {% trans "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:" %} {{ submission.submitted_at|date:"d.m.Y H:i" }}
                                </p>
                            </div>
                            <span class="badge" style="background: #f59e0b; color: white; padding: 0.25rem 0.75rem; border-radius: 12px;">
                                {{ submission.get_status_display }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center; color: #6b7280; padding: 2rem;">
                        {% trans "–ù–µ—Ç —Ä–∞–±–æ—Ç, –æ–∂–∏–¥–∞—é—â–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏" %}
                    </p>
                {% endif %}
            </div>

            <!-- Approved Tab -->
            <div class="tab-content" id="approved-tab" style="display: none;">
                {% if submissions_by_status.approved %}
                    {% for submission in submissions_by_status.approved|slice:":5" %}
                    <div class="submission-item success">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h4 style="margin: 0 0 0.25rem 0;">
                                    {{ submission.get_status_icon }} {{ submission.lesson.name }}
                                </h4>
                                <p style="margin: 0; color: #6b7280; font-size: 0.875rem;">
                                    {{ submission.lesson.course.name }}
                                </p>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: #10b981;">
                                    ‚úÖ {% trans "–û–¥–æ–±—Ä–µ–Ω–æ" %} {{ submission.reviewed_at|date:"d.m.Y" }}
                                </p>
                            </div>
                            <span class="badge" style="background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 12px;">
                                {{ submission.get_status_display }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center; color: #6b7280; padding: 2rem;">
                        {% trans "–ü–æ–∫–∞ –Ω–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç" %}
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- Achievements -->
        {% if achievements %}
        <div class="progress-container">
            <div class="progress-header">
                <h3 class="progress-title">{% trans "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è" %}</h3>
            </div>
            <div class="achievements-grid">
                {% for achievement in achievements %}
                <div class="achievement-card">
                    <div class="achievement-icon {{ achievement.color }}">
                        {% if achievement.color == 'success' %}
                            üåü
                        {% elif achievement.color == 'primary' %}
                            üéñÔ∏è
                        {% elif achievement.color == 'warning' %}
                            üëë
                        {% else %}
                            üèÜ
                        {% endif %}
                    </div>
                    <h4 class="achievement-title">{{ achievement.title }}</h4>
                    <p class="achievement-description">{{ achievement.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Recent Activity -->
        {% if recent_progress %}
        <div class="activity-feed">
            <div class="activity-header">
                <h3 class="activity-title">{% trans "–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å" %}</h3>
            </div>
            <div class="activity-list">
                {% for progress in recent_progress|slice:":10" %}
                <div class="activity-item">
                    <div class="activity-icon">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="activity-content">
                        <p class="activity-text">
                            {% trans "–í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥" %} <strong>{{ progress.step.name }}</strong>
                            {% trans "–≤ —É—Ä–æ–∫–µ" %} <strong>{{ progress.step.lesson.name }}</strong>
                        </p>
                        <span class="activity-time">{{ progress.completed_at|timesince }} {% trans "–Ω–∞–∑–∞–¥" %}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </main>
</div>

<!-- Data for JavaScript -->
<script>
window.dashboardData = {
    dailyActivity: {{ daily_activity|safe }},
    courseProgress: [
        {% for course_stat in course_stats %}
        {
            name: "{{ course_stat.course.name|escapejs }}",
            progress: {{ course_stat.completion_percentage }},
            color: "{% if course_stat.completion_percentage == 100 %}#10b981{% elif course_stat.completion_percentage >= 75 %}#f59e0b{% elif course_stat.completion_percentage >= 50 %}#3b82f6{% else %}#ef4444{% endif %}"
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ],
    translations: {
        noActivityTitle: "{% trans '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é' %}",
        noActivityText: "{% trans '–ù–∞—á–Ω–∏—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞–Ω–∏—è, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É' %}",
        noCoursesTitle: "{% trans '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤' %}",
        noCoursesText: "{% trans '–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫—É—Ä—Å, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ' %}"
    }
};
</script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/students/dashboard.js' %}"></script>
<script src="{% static 'js/students/dashboard-mobile.js' %}"></script>
<script src="{% static 'js/students/code-copy.js' %}"></script>
{% endblock %}
